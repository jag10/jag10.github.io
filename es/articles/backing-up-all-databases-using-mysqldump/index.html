
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
    <meta name=viewport content="width=device-width, initial-scale=1">
    <title>Arboleda - Haciendo un backup de todas las BD usando mysqldump</title>
    <meta name="description" content="El blog de Jeferson Arboleda, ingeniero informático. El blog está enfocado en la mejora de mis habilidades y en la superación de los retos que encuentro en mi día a día">
    
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="theme-color" content="#ffffff">
    	
	<meta property="og:title" content="Haciendo un backup de todas las BD usando mysqldump" />
	<meta property="og:description" content="En este post vamos a ver como hacer un backup de todas las bases de datos, tomando como ejemplo uno de los servidores con los que actualmente trabajo. Así, si surge algún problema con el servidor podremos disponer de un backup reciente.

Para ello, utilizo la utilidad mysqldump y un script para transferir los ficheros a un servidor ftp.
" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/" />
	<meta property="og:image" content="https://www.jarboleda.me/articles/img/backing-up-all-databases-using-mysqldump.png" />
	<meta property="og:updated_time" content="2015-08-30 11:05:36 &#43;0200 CEST"/>
	<meta property="og:locale" content="es-ES" />
	<meta property="og:site_name" content="Arboleda" />
	
	
	<meta property="article:published_time" content="2015-08-30 11:05:36 &#43;0200 CEST" />
	<meta property="article:modified_time" content="2015-08-30 11:05:36 &#43;0200 CEST" />
	<meta property="article:section" content="articles" />
	<meta property="article:tag" content="mysqldump" />
	<meta property="article:tag" content="bash" />
	
	
    
    <meta itemprop="name" content="Haciendo un backup de todas las BD usando mysqldump">
    <meta itemprop="description" content="En este post vamos a ver como hacer un backup de todas las bases de datos, tomando como ejemplo uno de los servidores con los que actualmente trabajo. Así, si surge algún problema con el servidor podremos disponer de un backup reciente.

Para ello, utilizo la utilidad mysqldump y un script para transferir los ficheros a un servidor ftp.
">
    <meta name="author" content="Jeferson Arboleda">
    
    <meta itemprop="image" content="backing-up-all-databases-using-mysqldump.png">
    
    <meta itemprop="keywords" content="notpinned,pinned,,true,serie1,bash,centos6,curl,cwp,fedora25,fopen,httpd,magento,magento2,mate,mysql,mysqldump,nodejs,odroid,php,php7,piwik,processwire,reflectionmethod,sass,ubuntu,unrealengine,vagrant,vm," />
    <meta itemprop="wordCount" content="352">
	
	<meta name="twitter:card" content="summary_large_image"/>
	<meta name="twitter:image:src" content="https://www.jarboleda.me/articles/img/backing-up-all-databases-using-mysqldump.png"/>
	
	<meta name="twitter:title" content="Haciendo un backup de todas las BD usando mysqldump"/>
	<meta name="twitter:description" content="En este post vamos a ver como hacer un backup de todas las bases de datos, tomando como ejemplo uno de los servidores con los que actualmente trabajo. Así, si surge algún problema con el servidor podremos disponer de un backup reciente.

Para ello, utilizo la utilidad mysqldump y un script para transferir los ficheros a un servidor ftp.
"/>
	<meta name="twitter:site" content="@j_a_g_x"/>
	
	<meta name="twitter:creator" content="@j_a_g_x"/>


	<meta name="news_keywords" content="mysqldump,bash" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link href="/css/global.min.css" media="screen" rel="stylesheet" type="text/css" />
  </head>
 <body>
  <header>
    <nav class='top-menu'>
      
      <div class="menu-wrapper" id="menu">
        <div class="pure-u-1 hidden">
          <div class="pure-menu menu-toogle-container">
            <a class="custom-toggle" id="toggle"><span class="bar"></span><span class="bar"></span></a>
          </div>
        </div>
        <div class="pure-u-1">
          <div class="pure-menu pure-menu-horizontal custom-can-transform">
            <ul class="pure-menu-list float-left">
              
              <li class="pure-menu-item"><a class='pure-menu-link' href=/es>home</a></li>
              
              <li class="pure-menu-item"><a class='pure-menu-link' href=/extras/cv/>sobre mi</a></li>
              
              <li class="pure-menu-item"><a class='pure-menu-link' href=/projects/>proyectos</a></li>
              
              <li class="pure-menu-item"><a class='pure-menu-link' href=https://github.com/jag10>github</a></li>
              
              <li class="pure-menu-item"><a class='pure-menu-link' href=https://gitlab.com/jag7>gitlab</a></li>
              
              <li class='pure-menu-item lang_selector selected'>
                
                <a class='pure-menu-link' href="#">Spanish</a>
                
              </li>
              <li class='pure-menu-item flag'><i class='fa fa-language' aria-hidden='true'></i></li>
               
              <li class='pure-menu-item lang_selector'>
                <a class='pure-menu-link' href="/articles/backing-up-all-databases-using-mysqldump/">english </a>
              </li>
               
            </ul>
            <div class="float-right">
              <ul class="pure-menu-list">
                
                <li class="pure-menu-item social_menu_entry">
                  <a href='https://www.linkedin.com/in/jeferson-arboleda-167429134' target='_blank'><i class='fa fa-linkedin'></i></a>
                </li>
                
                
                <li class="pure-menu-item social_menu_entry">
                  <a href='https://github.com/jag10' target='_blank'><i class='fa fa-github'></i></a>
                </li>
                
                
                <li class="pure-menu-item social_menu_entry">
                  <a href='https://gitlab.com/jag7' target='_blank'><i class='fa fa-gitlab'></i></a>
                </li>
                
                
                <li class="pure-menu-item social_menu_entry">
                  <a href='https://twitter.com/j_a_g_x' target='_blank'><i class='fa fa-twitter'></i></a>
                </li>
                
                <li class='pure-menu-item nt-search' id='nt-search'>
                  <form action='/search/' id='searchform' method='get'>
                    <div class='nt-search-input-wrap'>
                      <input class='nt-search-input' id='s' name='q' placeholder='Search is disabled :(' type='text' value='' disabled />
                    </div>
                    <input class='nt-search-submit' id='go' type='submit' value='Search' />
                    <span class='nt fa fa-search'></span>
                  </form>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </nav>
    
    
  </header>

  <div class="main-container">
    <section id="main" class="pure-u-1 pure-u-md-3-4">
      <article>
        <div class="post-container">
  
  <div class="article_summary">
    <div class="article-date">
      <p class="day"><i class="fa fa-calendar"></i>30 Aug 2015</p>
      <p><i class="fa fa-clock-o"></i>3 min read  ~ 400 words</p>
    </div>
    
    <div class="article-tags">
      
      <a href="#" rel="tag">mysqldump</a> 
      <a href="#" rel="tag">bash</a> 
    </div>
    
    <div class="clearfix"></div>
    
    <h1 class="article_title title">Haciendo un backup de todas las BD usando mysqldump</h1>
    
    <div class="article_excerpt">
      
      <p><p>En este post vamos a ver como hacer un backup de todas las bases de datos, tomando como ejemplo uno de los servidores con los que actualmente trabajo. Así, si surge algún problema con el servidor podremos disponer de un backup reciente.</p>

<p>Para ello, utilizo la utilidad mysqldump y un script para transferir los ficheros a un servidor ftp.
</p>

<p>Hacer el backup de las bases de datos con mysqldump es muy fácil:
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>mysqldump -uadmin -p<span style="color: #e6db74">`</span>cat /etc/psa/.psa.shadow<span style="color: #e6db74">`</span> --all-databases <span style="color: #f8f8f2">|</span> zip &gt; <span style="color: #f8f8f2">$1</span>/all.sql.zip
</pre></div>
</p>

<p>El parámetro -p indica la password para el usuario admin. Yo utilizo ese fichero porque plesk almacena su contraseña ahí, pero se puede cambiar. La última parte es muy importante, siempre debe comprimirse el fichero .sql porque puede ahorrarse hasta un 90% de espacio. Por ejemplo, algunos backups ocupan 250mb comprimidos, pero cuando lo extraes el fichero .sql puede ser de alrededor de 2.5Gb
Con el siguiente script se puede hacer un backup de las bases de datos y transferirlo a un servidor ftp, almacenandolo en el directorio /aaa.bbb.ccc.ddd/, o donde quieras
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/sh</span>

<span style="color: #f8f8f2">tempDir</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">$1</span>

<span style="color: #f8f8f2">date</span><span style="color: #f92672">=</span><span style="color: #66d9ef">$(</span>date +%y%m%d-%H%M<span style="color: #66d9ef">)</span>
mysqldump -uadmin -p<span style="color: #e6db74">`</span>cat /etc/psa/.psa.shadow<span style="color: #e6db74">`</span> --all-databases <span style="color: #f8f8f2">|</span> zip &gt; <span style="color: #f8f8f2">$tempDir</span>/all.sql.zip

/script/ftpConnect.sh <span style="color: #f8f8f2">$tempDir</span>/all.sql.zip /aaa.bbb.ccc.ddd/_bbdd/<span style="color: #f8f8f2">$date</span>.sql.zip
</pre></div>

Para descomprimir los ficheros se puede usar el siguiente script.
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">#!/bin/sh</span>
<span style="color: #f8f8f2">file</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">$1</span>

unzip -p <span style="color: #f8f8f2">$file</span> <span style="color: #f8f8f2">|</span> cat &gt; ALL_DATABASES.sql

csplit --digits<span style="color: #f92672">=</span><span style="color: #ae81ff">3</span> --quiet --prefix<span style="color: #f92672">=</span>outfile ALL_DATABASES.sql <span style="color: #e6db74">&#39;/Current Database/&#39;</span> <span style="color: #e6db74">&#39;{*}&#39;</span>

<span style="color: #f8f8f2">files</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;outfile.*&#39;</span>
<span style="color: #f8f8f2">regex</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;Current Database: `(.*)`&#39;</span>

<span style="color: #66d9ef">for</span> i in <span style="color: #66d9ef">$(</span>ls <span style="color: #f8f8f2">|</span> grep <span style="color: #e6db74">&#39;outfile&#39;</span><span style="color: #66d9ef">)</span>
<span style="color: #66d9ef">do</span>
	<span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #66d9ef">$(</span>head <span style="color: #f8f8f2">$i</span> <span style="color: #f8f8f2">|</span> egrep -o <span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">$regex</span><span style="color: #e6db74">&quot;</span> <span style="color: #f8f8f2">|</span> awk -F <span style="color: #e6db74">&#39;`&#39;</span> <span style="color: #e6db74">&#39;{print $2}&#39;</span><span style="color: #66d9ef">)</span>
	<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&quot;</span><span style="color: #f8f8f2">$i</span><span style="color: #e6db74">: </span><span style="color: #f8f8f2">$name</span><span style="color: #e6db74">&quot;</span>
    <span style="color: #66d9ef">if</span> <span style="color: #f92672">[</span> ! -f <span style="color: #f8f8f2">$name</span> <span style="color: #f92672">]</span><span style="color: #f8f8f2">;</span> <span style="color: #66d9ef">then</span>
	    mv <span style="color: #f8f8f2">$i</span> <span style="color: #f8f8f2">$name</span>
    <span style="color: #66d9ef">else</span>
        <span style="color: #f8f8f2">number</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">$RANDOM</span>
        <span style="color: #f8f8f2">let</span> <span style="color: #e6db74">&quot;number %= 10&quot;</span>
        mv <span style="color: #f8f8f2">$i</span> <span style="color: #f8f8f2">$name$number</span>
    <span style="color: #66d9ef">fi</span>
<span style="color: #66d9ef">done</span>
</pre></div>
</p>

<p>Ok, con este script se descomprimen las bases de datos y se separan en diferentes ficheros, utilizando el separador `<code>Current Database</code>, el {*} le indica a csplit que divida el fichero en tantas partes como sea necesario, dado que por defecto lo divide en solo dos partes, La siguiente parte renombra los ficheros para que sea sencillo identificarlos</p>

<p>Además, hay que revisar el fichero outfile000, dado que contiene algunas cabeceras que deberían ser incluidas en cada fichero de base de datos. Esto se puede hacer con bash también.</p></p>
      
    </div>
    <div class="clearfix"></div>
    
    <div class="article_resources">
      <h2>Resources</h2>
      <ul>
        
        <li>
          
          <a target="_blank" href="https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html">mysqldump en dev.mysql.com</a> 
        </li>
        
      </ul>
    </div>
    
    <div class="article-footer">
      
      




<div class="soc-sharing">
  <ul class="article_share_items">
    <li>
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/&amp;title=Haciendo%20un%20backup%20de%20todas%20las%20BD%20usando%20mysqldump&amp;summary=%3cp%3eEn%20este%20post%20vamos%20a%20ver%20como%20hacer%20un%20backup%20de%20todas%20las%20bases%20de%20datos,%20tomando%20como%20ejemplo%20uno%20de%20los%20servidores%20con%20los%20que%20actualmente%20trabajo.%20As%c3%ad,%20si%20surge%20alg%c3%ban%20problema%20con%20el%20servidor%20podremos%20disponer%20de%20un%20backup%20reciente.%3c/p%3e%0a%0a%3cp%3ePara%20ello,%20utilizo%20la%20utilidad%20mysqldump%20y%20un%20script%20para%20transferir%20los%20ficheros%20a%20un%20servidor%20ftp.%0a%3c/p%3e&amp;source=Arboleda" onclick="window.open(this.href, 'windowName', 'width=550, height=600, left=24, top=24, scrollbars, resizable'); return false" rel="nofollow" target="_blank"></a>
    </li>
    <li>
      <a class="fa fa-twitter" href="http://twitter.com/share?text=Haciendo%20un%20backup%20de%20todas%20las%20BD%20usando%20mysqldump&amp;url=https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/" onclick="window.open(this.href, 'windowName', 'width=550, height=600, left=24, top=24, scrollbars, resizable'); return false" rel="nofollow" target="_blank"></a>
    </li>
    <li>
      <a class="fa fa-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/" onclick="window.open(this.href, 'windowName', 'width=550, height=600, left=24, top=24, scrollbars, resizable'); return false" rel="nofollow" target="_blank"></a>
    </li>
    <li>
      <a class="fa fa-google-plus" href="https://plus.google.com/share?url=https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/" onclick="window.open(this.href, 'windowName', 'width=550, height=600, left=24, top=24, scrollbars, resizable'); return false" rel="nofollow" target="_blank"></a>
    </li>
    <li>
      <a class="fa fa-pinterest" href="https://pinterest.com/pin/create/button/?url=https://www.jarboleda.me/es/articles/backing-up-all-databases-using-mysqldump/&amp;media=https://www.jarboleda.mebacking-up-all-databases-using-mysqldump.png&amp;description=%3cp%3eEn%20este%20post%20vamos%20a%20ver%20como%20hacer%20un%20backup%20de%20todas%20las%20bases%20de%20datos,%20tomando%20como%20ejemplo%20uno%20de%20los%20servidores%20con%20los%20que%20actualmente%20trabajo.%20As%c3%ad,%20si%20surge%20alg%c3%ban%20problema%20con%20el%20servidor%20podremos%20disponer%20de%20un%20backup%20reciente.%3c/p%3e%0a%0a%3cp%3ePara%20ello,%20utilizo%20la%20utilidad%20mysqldump%20y%20un%20script%20para%20transferir%20los%20ficheros%20a%20un%20servidor%20ftp.%0a%3c/p%3e" onclick="window.open(this.href, 'windowName', 'width=550, height=600, left=24, top=24, scrollbars, resizable'); return false" rel="nofollow" target="_blank"></a>
    </li>
  </ul>
</div>

    </div>

    <div class='post-footer'>
      
       <div id="disqus_thread"></div>
<script>





var disqus_shortname = 'jarboleda-me';
(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://jarboleda-me.disqus.com/embed.js';
s.async = true; 
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

     
    </div>
  </div>
</div>

      </article>
    </section><aside class='sidebar-wrapper pure-u-1 pure-u-md-1-4 sticky'>
      
<div class='sidebar'>
  

<div class='authorboxwrap'>
<h4>Author</h4>
    <div class='avatar-container'>
      <img alt="author's photo" class='author_avatar' width='160' height='136' src="/img/me.min.png"  />
      <h4 rel='author'>Jeferson Arboleda</h4>
    </div>
    <div class='author_description_container'>
      <p>Buscando un desafío :) | Actualmente estoy interesdo en <a href="https://docker.com">Docker</a>, <a href="https://kubernetes.io/">kubernetes</a>, e <a href="https://www.ibm.com/cloud-computing/bluemix/">IBM bluemix</a></p>
      <div class='authorsocial'>
        
          <a href='https://www.linkedin.com/in/jeferson-arboleda-167429134' target='_blank'><i class='fa fa-linkedin'></i></a>
        
        
          <a href='https://github.com/jag10' target='_blank'><i class='fa fa-github'></i></a>
        
        
          <a href='https://gitlab.com/jag7' target='_blank'><i class='fa fa-gitlab'></i></a>
        
        
          <a href='https://twitter.com/j_a_g_x' target='_blank'><i class='fa fa-twitter'></i></a>
        
      </div>
    </div>
</div>

  
  <h4>On This Page</h4>
  <div class='table_of_contents'>
    
  </div>
  
</div>


    </aside>
    <div class='clearfix'></div>
  </div>
  <footer>
  <div class='footer-container'>
    <div class='pure-u-1 pure-u-md-1-3'>
      <div class='widget popular-posts'>
        <div class="widget-title">
          <h2>Other posts</h2></div>
        <div class='widget-content popular-posts'>
          <ul>
            
             
            <li>
              <div class='item-content'>
                <div class='item-thumbnail'>
                  <a href='/es/articles/authenticating-users-in-joomla-with-curl/' target='_blank'>
                    <img alt='Autenticando usuarios con cURL' width='72' height='72' src="/articles/img/thumbs/authenticating-users-in-joomla-with-curl.jpg" />
                  </a>
                </div>
                <div class='item-title'>
                  <a href='/es/articles/authenticating-users-in-joomla-with-curl/' class="mostVisitedLink">Autenticando usuarios con cURL</a>
                </div>
              </div>
            </li>
            
            
             
            <li>
              <div class='item-content'>
                <div class='item-thumbnail'>
                  <a href='/es/articles/centos-web-panel-on-vps/' target='_blank'>
                    <img alt='Centos web panel con php7 y mysql5.6' width='72' height='72' src="/articles/img/thumbs/installing-centos-web-panel-on-vps.jpg" />
                  </a>
                </div>
                <div class='item-title'>
                  <a href='/es/articles/centos-web-panel-on-vps/' class="mostVisitedLink">Centos web panel con php7 y mysql5.6</a>
                </div>
              </div>
            </li>
            
            
            
            
          </ul>
        </div>
      </div>
    </div>
    <div class='pure-u-1 pure-u-md-1-3'>
      <div class='widget ContactForm'>
        <h2 class='title'>Contact me</h2>
        <a class="email" href="mailto:me@jarboleda.me">me@jarboleda.me</a>
        <div class='contact-form-widget'>
          <div class='form'>
            <form name='contact-form' action="https://formspree.io/me@jarboleda.me" method="POST">
              <p>Name</p>
              <input class='contact-form-name' name='name' size='30' type='text' value='' />
              <p>Email<span>*</span></p>
              <input class='contact-form-email' name='name="_replyto"' size='30' type='text' value='' />
              <p>Message<span>*</span></p>
              <p><textarea class='contact-form-email-message' cols='29' name='email-message' rows='5'></textarea></p>
              <input class='contact-form-button contact-form-button-submit' type='submit' value='Send' />
              <div style='text-align: center; max-width: 222px; width: 100%'>
                <p class='contact-form-error-message'></p>
                <p class='contact-form-success-message'></p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class='footer-credits'>
    <div class='footer_social-icons'>
      <ul>
        
        <li>
          <a class="btn-linkedin" href='https://www.linkedin.com/in/jeferson-arboleda-167429134' target='_blank'><i class='fa fa-linkedin'></i></a>
        </li>
        
        
        <li>
          <a class="btn-github" href='https://github.com/jag10' target='_blank'><i class='fa fa-github'></i></a>
        </li>
        
        
        <li>
          <a class="btn-gitlab" href='https://gitlab.com/jag7' target='_blank'><i class='fa fa-gitlab'></i></a>
        </li>
        
        
        <li>
          <a class="btn-twitter" href='https://twitter.com/j_a_g_x' target='_blank'><i class='fa fa-twitter'></i></a>
        </li>
        
      </ul>
    </div>
    <div class='clr'></div>
    <p>Copyright &#169; 2017
      <a href='https://www.jarboleda.me'>https://www.jarboleda.me</a>
    </p>
    <p class='attribution'>Powered by</p>
    <a href='https://gohugo.io/' target="_blank" >
      <img with="80" height="21" alt="hugo logo" class='attribution_logo' src="/img/hugo-logo.png" />
    </a>
  </div>
</footer>

<script defer src='/js/main.min.js' type='text/javascript'></script>

<script type="text/javascript">
  window.cookieconsent_options = {
    "message": "This website uses cookies to ensure you get the best experience on our website",
    "dismiss": "Got it!",
    "learnMore": "More info",
    "link": null,
    "theme": "light-bottom"
  };
</script>
<script defer type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.10/cookieconsent.min.js"></script>



<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-101857703-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>


</body>
</html>

